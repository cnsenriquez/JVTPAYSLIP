<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JVT & Litrad ‚Äî Payslip System</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --navy:#0f2444; --navy-mid:#1a3a6b; --gold:#c9a84c; --gold-light:#e8c97a;
    --cream:#faf7f0; --red:#c0392b; --red-light:#fdf0ef;
    --green:#1e6b45; --green-light:#e8f5ee;
    --amber:#d97706; --amber-light:#fffbeb;
    --gray:#6b7280; --gray-light:#f3f4f6;
    --white:#ffffff; --border:#d4c9b0;
    --shadow:0 4px 24px rgba(15,36,68,0.10);
    --shadow-lg:0 12px 48px rgba(15,36,68,0.18);
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--navy);min-height:100vh;}

  /* HEADER */
  .app-header{background:var(--navy);padding:0 40px;display:flex;align-items:center;justify-content:space-between;height:64px;border-bottom:3px solid var(--gold);position:sticky;top:0;z-index:100;}
  .header-title{font-family:'DM Serif Display',serif;font-size:18px;color:var(--white);}
  .header-sub{font-size:11px;color:var(--gold-light);letter-spacing:2px;text-transform:uppercase;margin-top:1px;}
  .nav-tabs{display:flex;gap:4px;}
  .nav-tab{padding:8px 20px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;color:#adb5bd;border:none;background:transparent;transition:all 0.2s;}
  .nav-tab:hover{color:var(--white);background:rgba(255,255,255,0.08);}
  .nav-tab.active{background:var(--gold);color:var(--navy);font-weight:600;}

  .app-body{max-width:1160px;margin:0 auto;padding:32px 24px;}
  .page{display:none;} .page.active{display:block;}
  .page-title{margin-bottom:24px;}
  .page-title h2{font-family:'DM Serif Display',serif;font-size:26px;color:var(--navy);}
  .page-title p{font-size:13px;color:var(--gray);margin-top:4px;}

  /* CARDS */
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
  .section-card{background:var(--white);border-radius:12px;border:1px solid var(--border);box-shadow:var(--shadow);overflow:hidden;}
  .section-card.full{grid-column:1/-1;}
  .card-header{background:var(--navy);padding:11px 20px;display:flex;align-items:center;gap:10px;}
  .card-header-icon{width:26px;height:26px;background:rgba(201,168,76,0.2);border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:13px;}
  .card-header h3{font-family:'DM Serif Display',serif;font-size:14px;color:var(--white);}
  .card-body{padding:20px;}

  /* FIELDS */
  .field-row{display:grid;gap:14px;margin-bottom:14px;}
  .field-row:last-child{margin-bottom:0;}
  .field-row.cols-2{grid-template-columns:1fr 1fr;}
  .field-row.cols-3{grid-template-columns:1fr 1fr 1fr;}
  .field-row.cols-4{grid-template-columns:1fr 1fr 1fr 1fr;}
  .field-row.cols-1{grid-template-columns:1fr;}
  .field{display:flex;flex-direction:column;gap:5px;}
  .field label{font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--gray);}
  .field label span.req{color:var(--red);margin-left:2px;}
  .field input,.field select{border:1.5px solid var(--border);border-radius:8px;padding:10px 14px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--navy);background:var(--cream);transition:all 0.2s;outline:none;width:100%;}
  .field input:focus,.field select:focus{border-color:var(--navy-mid);background:var(--white);box-shadow:0 0 0 3px rgba(26,58,107,0.08);}
  .field input.calc{background:var(--green-light);color:var(--green);font-family:'DM Mono',monospace;font-size:13px;font-weight:600;}
  .field input.auto-fill{background:#eef4fb;color:var(--navy-mid);font-family:'DM Mono',monospace;font-size:13px;}

  /* EMPLOYEE QUICK-FILL */
  .emp-quick-bar{background:var(--amber-light);border:1px solid #fcd34d;border-radius:10px;padding:14px 18px;margin-bottom:14px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
  .emp-quick-bar label{font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--amber);white-space:nowrap;}
  .emp-quick-bar select{border:1.5px solid #fcd34d;border-radius:8px;padding:8px 12px;font-size:13px;color:var(--navy);background:var(--white);outline:none;flex:1;min-width:180px;cursor:pointer;}
  .btn-save-emp{background:var(--amber);color:var(--white);border:none;border-radius:8px;padding:8px 16px;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;transition:all 0.2s;display:flex;align-items:center;gap:6px;}
  .btn-save-emp:hover{background:#b45309;}
  .btn-del-emp{background:transparent;border:1.5px solid #fcd34d;border-radius:8px;padding:8px 12px;font-size:12px;color:var(--amber);cursor:pointer;transition:all 0.2s;white-space:nowrap;}
  .btn-del-emp:hover{background:var(--red-light);border-color:var(--red);color:var(--red);}

  /* Save Employee Modal */
  .emp-modal-overlay{display:none;position:fixed;inset:0;background:rgba(15,36,68,0.6);backdrop-filter:blur(4px);z-index:1200;align-items:center;justify-content:center;}
  .emp-modal-overlay.open{display:flex;}
  .emp-modal{background:var(--white);border-radius:16px;width:90%;max-width:420px;box-shadow:var(--shadow-lg);animation:modalIn 0.2s ease;}
  .emp-modal-header{background:var(--amber);padding:16px 20px;border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:space-between;}
  .emp-modal-header h3{font-family:'DM Serif Display',serif;font-size:16px;color:var(--white);}
  .emp-modal-close{background:rgba(255,255,255,0.2);border:none;border-radius:6px;width:28px;height:28px;color:var(--white);cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;}
  .emp-modal-close:hover{background:rgba(255,255,255,0.3);}
  .emp-modal-body{padding:20px;}
  .emp-modal-footer{padding:14px 20px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end;}
  .emp-list{max-height:240px;overflow-y:auto;border:1px solid var(--border);border-radius:8px;margin-top:12px;}
  .emp-list-item{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--gray-light);font-size:13px;}
  .emp-list-item:last-child{border-bottom:none;}
  .emp-list-item:hover{background:var(--cream);}
  .emp-list-name{font-weight:600;color:var(--navy);}
  .emp-list-salary{font-family:'DM Mono',monospace;font-size:12px;color:var(--green);}
  .btn-emp-del-row{background:transparent;border:none;color:var(--red);cursor:pointer;font-size:14px;padding:2px 6px;border-radius:4px;}
  .btn-emp-del-row:hover{background:var(--red-light);}
  .no-emp{text-align:center;padding:24px;color:var(--gray);font-size:13px;}

  /* EARNINGS / DEDUCTIONS SPLIT */
  .split-grid{display:grid;grid-template-columns:1fr 1fr;gap:0;}
  .split-col{padding:16px 20px;}
  .split-col:first-child{border-right:1px solid var(--border);}
  .split-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:10px;border-bottom:2px solid var(--navy);margin-bottom:12px;}
  .split-header span{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--navy);}
  .split-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
  .split-row label{font-size:12px;color:var(--gray);min-width:120px;flex-shrink:0;}
  .split-row input{border:1.5px solid var(--border);border-radius:6px;padding:7px 10px;font-family:'DM Mono',monospace;font-size:13px;color:var(--navy);background:var(--cream);width:100%;outline:none;transition:all 0.2s;}
  .split-row input:focus{border-color:var(--navy-mid);background:var(--white);}
  .total-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-top:2px solid var(--navy);margin-top:8px;}
  .total-row span{font-size:13px;font-weight:700;color:var(--navy);}
  .total-val{font-family:'DM Mono',monospace;font-size:14px;font-weight:700;color:var(--navy);}

  /* NET PAY STRIP */
  .net-strip{background:var(--navy);border-radius:10px;padding:18px 28px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
  .net-strip .nl{font-size:12px;letter-spacing:2px;text-transform:uppercase;color:#8ba3c7;}
  .net-strip .nv{font-family:'DM Mono',monospace;font-size:28px;font-weight:600;color:var(--gold-light);}
  .net-strip .nw{font-size:12px;color:#adb5bd;font-style:italic;max-width:500px;text-align:right;}

  /* BUTTONS */
  .submit-row{display:flex;gap:12px;align-items:center;}
  .btn-submit{flex:1;background:linear-gradient(135deg,var(--green) 0%,#155c38 100%);color:var(--white);border:none;border-radius:10px;padding:15px 32px;font-family:'DM Serif Display',serif;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.2s;box-shadow:0 4px 16px rgba(30,107,69,0.3);}
  .btn-submit:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(30,107,69,0.4);}
  .btn-clear{background:transparent;border:1.5px solid var(--border);border-radius:10px;padding:15px 24px;font-size:14px;color:var(--gray);cursor:pointer;transition:all 0.2s;}
  .btn-clear:hover{border-color:var(--red);color:var(--red);}

  /* TOAST */
  .toast{display:none;align-items:center;gap:10px;background:var(--green-light);border:1px solid #a8d5be;border-radius:8px;padding:12px 16px;font-size:13px;color:var(--green);font-weight:500;margin-bottom:16px;animation:slideIn 0.3s ease;}
  .toast.show{display:flex;}
  .toast.error{background:var(--red-light);border-color:#f5c6c2;color:var(--red);}
  @keyframes slideIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}

  /* DATABASE */
  .db-toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:12px;flex-wrap:wrap;}
  .db-search-box{border:1.5px solid var(--border);border-radius:8px;padding:9px 14px;font-size:13px;color:var(--navy);background:var(--white);outline:none;width:280px;transition:all 0.2s;}
  .db-search-box:focus{border-color:var(--navy-mid);}
  .db-stats{display:flex;gap:12px;flex-wrap:wrap;}
  .db-stat{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:8px 16px;font-size:12px;color:var(--gray);}
  .db-stat strong{display:block;font-size:17px;color:var(--navy);font-family:'DM Mono',monospace;}
  .table-wrap{background:var(--white);border-radius:12px;border:1px solid var(--border);box-shadow:var(--shadow);overflow:auto;}
  table{width:100%;border-collapse:collapse;min-width:900px;}
  thead tr{background:var(--navy);}
  thead th{padding:12px 14px;text-align:left;font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:#8ba3c7;white-space:nowrap;}
  thead th:first-child{color:var(--gold-light);}
  tbody tr{border-bottom:1px solid var(--gray-light);transition:background 0.15s;}
  tbody tr:hover{background:#f8f9ff;}
  tbody tr:last-child{border-bottom:none;}
  tbody td{padding:11px 14px;font-size:13px;color:var(--navy);white-space:nowrap;}
  td.mono{font-family:'DM Mono',monospace;font-size:12px;}
  td.net{color:var(--green);font-family:'DM Mono',monospace;font-weight:700;text-align:right;}
  td.amount{font-family:'DM Mono',monospace;font-weight:600;text-align:right;}
  .badge{display:inline-block;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600;}
  .badge.jvt{background:#eef4fb;color:var(--navy-mid);}
  .badge.lit{background:var(--amber-light);color:var(--amber);}
  .empty-state{text-align:center;padding:60px 20px;color:var(--gray);}
  .empty-state .es-icon{font-size:48px;margin-bottom:12px;opacity:0.4;}
  .action-btns{display:flex;gap:6px;}
  .btn-icon{border:none;border-radius:6px;padding:5px 10px;font-size:12px;cursor:pointer;transition:all 0.15s;white-space:nowrap;display:flex;align-items:center;gap:4px;}
  .btn-icon.view{background:var(--navy);color:var(--white);}
  .btn-icon.view:hover{background:var(--navy-mid);}
  .btn-icon.edit{background:var(--amber-light);color:var(--amber);border:1px solid #fcd34d;}
  .btn-icon.edit:hover{background:#fef3c7;}
  .btn-icon.del{background:var(--red-light);color:var(--red);border:1px solid #fca5a5;}
  .btn-icon.del:hover{background:#fee2e2;}

  /* CONFIRM */
  .confirm-overlay{display:none;position:fixed;inset:0;background:rgba(15,36,68,0.7);backdrop-filter:blur(4px);z-index:1100;align-items:center;justify-content:center;}
  .confirm-overlay.open{display:flex;}
  .confirm-box{background:var(--white);border-radius:14px;padding:32px;max-width:420px;width:90%;box-shadow:var(--shadow-lg);text-align:center;animation:modalIn 0.2s ease;}
  @keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
  .confirm-icon{font-size:48px;margin-bottom:16px;}
  .confirm-box h3{font-family:'DM Serif Display',serif;font-size:20px;color:var(--navy);margin-bottom:8px;}
  .confirm-box p{font-size:13px;color:var(--gray);margin-bottom:24px;line-height:1.6;}
  .confirm-btns{display:flex;gap:12px;justify-content:center;}
  .btn-confirm-del{background:var(--red);color:var(--white);border:none;border-radius:8px;padding:10px 28px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;}
  .btn-confirm-del:hover{background:#a93226;}
  .btn-confirm-cancel{background:transparent;border:1.5px solid var(--border);border-radius:8px;padding:10px 20px;font-size:14px;color:var(--gray);cursor:pointer;transition:all 0.2s;}
  .btn-confirm-cancel:hover{border-color:var(--navy);color:var(--navy);}

  /* EDIT MODAL */
  .modal-overlay{display:none;position:fixed;inset:0;background:rgba(15,36,68,0.6);backdrop-filter:blur(4px);z-index:1000;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto;}
  .modal-overlay.open{display:flex;}
  .modal{background:var(--white);border-radius:16px;width:100%;max-width:900px;box-shadow:var(--shadow-lg);animation:modalIn 0.25s ease;margin:auto;}
  .modal-header{background:var(--navy);padding:18px 24px;border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:space-between;}
  .modal-header h3{font-family:'DM Serif Display',serif;font-size:18px;color:var(--white);}
  .modal-close{background:rgba(255,255,255,0.1);border:none;border-radius:6px;width:30px;height:30px;color:var(--white);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
  .modal-close:hover{background:rgba(255,255,255,0.2);}
  .modal-body{padding:24px;}
  .modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:12px;justify-content:flex-end;}
  .btn-save{background:var(--green);color:var(--white);border:none;border-radius:8px;padding:10px 28px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;}
  .btn-save:hover{background:#155c38;}
  .btn-cancel{background:transparent;border:1.5px solid var(--border);border-radius:8px;padding:10px 20px;font-size:14px;color:var(--gray);cursor:pointer;transition:all 0.2s;}
  .btn-cancel:hover{border-color:var(--red);color:var(--red);}

  /* PRINT SELECTOR */
  .print-selector{background:var(--white);border-radius:12px;border:1px solid var(--border);box-shadow:var(--shadow);padding:18px 24px;margin-bottom:24px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
  .print-selector label{font-size:13px;font-weight:600;color:var(--gray);white-space:nowrap;}
  .print-selector select{border:1.5px solid var(--border);border-radius:8px;padding:9px 14px;font-size:13px;color:var(--navy);background:var(--cream);outline:none;flex:1;min-width:200px;transition:all 0.2s;}
  .btn-print{background:var(--navy);color:var(--white);border:none;border-radius:8px;padding:10px 24px;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;}
  .btn-print:hover{background:var(--navy-mid);}
  .no-payslip{text-align:center;padding:80px 20px;color:var(--gray);}
  .no-payslip .nv-icon{font-size:56px;opacity:0.25;margin-bottom:16px;}

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAYSLIP PRINT LAYOUT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .payslip-paper{
    background:var(--white);border:1px solid #ccc;border-radius:4px;
    max-width:720px;margin:0 auto;font-family:'DM Sans',sans-serif;
    box-shadow:var(--shadow-lg);
  }

  /* Company header - no logo, text only */
  .ps-company-area{text-align:center;padding:22px 40px 12px;border-bottom:2px solid var(--navy);}
  .ps-company-name{font-family:'DM Serif Display',serif;font-size:28px;color:var(--navy);font-weight:700;letter-spacing:1px;}
  .ps-litrad-name{font-family:'DM Serif Display',serif;font-size:28px;color:var(--navy);font-weight:700;letter-spacing:2px;}

  .ps-title{text-align:center;padding:6px 0 4px;}
  .ps-title h2{font-size:15px;font-weight:700;letter-spacing:2px;color:var(--navy);}
  .ps-address{text-align:center;font-size:10px;color:var(--gray);line-height:1.5;padding-bottom:10px;}

  /* Section header bar */
  .ps-section-bar{background:var(--navy);color:var(--white);text-align:center;font-size:12px;font-weight:700;letter-spacing:2px;padding:6px;border-top:1px solid #bbb;border-bottom:1px solid #bbb;}

  /* Info rows */
  .ps-info-grid{display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid #bbb;}
  .ps-info-col{padding:0;}
  .ps-info-row{display:grid;grid-template-columns:130px 1fr;align-items:center;padding:7px 16px;border-bottom:1px solid #eee;}
  .ps-info-row:last-child{border-bottom:none;}
  .ps-info-label{font-size:11px;color:var(--gray);}
  .ps-info-value{font-size:12px;font-weight:600;color:var(--navy);}
  .ps-info-grid .ps-info-col:first-child{border-right:1px solid #bbb;}

  /* Earnings / Deductions table */
  .ps-table{display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid #bbb;}
  .ps-col{display:flex;flex-direction:column;}
  .ps-col:first-child{border-right:1px solid #bbb;}
  .ps-col-header{display:grid;grid-template-columns:1fr auto;padding:7px 16px;border-bottom:1px solid #bbb;background:#f8f7f5;}
  .ps-col-header span{font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--navy);}
  .ps-item{display:grid;grid-template-columns:1fr auto;padding:6px 16px;border-bottom:1px solid #f0ede6;min-height:30px;align-items:center;}
  .ps-item:last-child{border-bottom:none;}
  .ps-item-label{font-size:12px;color:var(--navy);}
  .ps-item-val{font-size:12px;font-family:'DM Mono',monospace;color:var(--navy);text-align:right;}
  .ps-total-row{display:grid;grid-template-columns:1fr auto;padding:8px 16px;background:#f0ede6;border-top:2px solid var(--navy);}
  .ps-total-label{font-size:12px;font-weight:700;color:var(--navy);}
  .ps-total-val{font-size:13px;font-weight:700;font-family:'DM Mono',monospace;color:var(--navy);}

  /* Net Pay */
  .ps-net-bar{text-align:center;padding:10px 16px;border-bottom:1px solid #bbb;background:#f8f7f5;}
  .ps-net-bar span{font-size:14px;font-weight:700;color:var(--navy);letter-spacing:1px;}

  /* Amount in words */
  .ps-words-row{padding:10px 16px;border-bottom:1px solid #bbb;display:flex;gap:12px;align-items:baseline;}
  .ps-words-label{font-size:11px;color:var(--gray);white-space:nowrap;}
  .ps-words-value{font-size:12px;color:var(--navy);font-style:italic;}

  /* Signatures */
  .ps-sigs{display:grid;grid-template-columns:1fr 1fr;padding:20px 40px 28px;}
  .ps-sig-block{text-align:center;}
  .ps-sig-name{font-size:13px;font-weight:700;color:var(--navy);margin-bottom:0;}
  .ps-sig-role{font-size:11px;color:var(--gray);}
  .ps-sig-line{border-bottom:1px solid #999;margin:16px 20px 6px;}
  .ps-prepared-by{text-align:center;}
  .ps-prepared-label{font-size:11px;color:var(--gray);margin-bottom:12px;}

  @media print {
    .app-header,.print-selector,.btn-print,.no-print{display:none !important;}
    .payslip-paper{box-shadow:none;border:1px solid #ccc;}
    body{background:white;}
    .app-body{padding:0;}
  }
</style>
</head>
<body>

<div id="firebase-banner" style="background:#fef3c7;border-bottom:2px solid #f59e0b;padding:12px 40px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
  <span style="font-size:18px">üî•</span>
  <div style="flex:1;">
    <strong style="font-size:13px;color:#92400e;">Firebase Setup Required</strong>
    <p style="font-size:12px;color:#78350f;margin-top:2px;">
      To make this a real shared web app, replace <code style="background:#fde68a;padding:1px 5px;border-radius:3px;">YOUR_API_KEY</code> and other values in the script with your Firebase config.
      <a href="https://console.firebase.google.com/" target="_blank" style="color:#b45309;font-weight:700;margin-left:6px;">Open Firebase Console ‚Üí</a>
    </p>
  </div>
  <button onclick="document.getElementById('firebase-banner').style.display='none'" style="background:transparent;border:1px solid #f59e0b;border-radius:6px;padding:5px 12px;font-size:12px;color:#92400e;cursor:pointer;">Dismiss</button>
</div>

<header class="app-header">
  <div>
    <div class="header-title">JVT & LITRAD INC</div>
    <div class="header-sub">Payslip System</div>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('entry',this)">‚ú¶ Create Payslip</button>
    <button class="nav-tab" onclick="showPage('database',this)">üìã Records</button>
    <button class="nav-tab" onclick="showPage('employees',this)">üë• Employees</button>
    <button class="nav-tab" onclick="showPage('print',this)">üñ® Print Payslip</button>
  </nav>
</header>

<div class="app-body">

  <!-- ‚ïê‚ïê ENTRY FORM ‚ïê‚ïê -->
  <div class="page active" id="page-entry">
    <div class="page-title">
      <h2>Create Payslip</h2>
      <p>Fill in employee details, earnings and deductions ‚Äî net pay is computed automatically.</p>
    </div>
    <div id="toast" class="toast"></div>

    <div class="form-grid">

      <!-- Company & Employee -->
      <div class="section-card">
        <div class="card-header"><div class="card-header-icon">üè¢</div><h3>Company & Employee</h3></div>
        <div class="card-body">

          <!-- Quick-fill from saved employees -->
          <div class="emp-quick-bar">
            <label>üìÇ Saved Employees</label>
            <select id="emp-quick-select" onchange="quickFillEmployee()">
              <option value="">‚Äî Quick fill from saved ‚Äî</option>
            </select>
          </div>

          <div class="field-row cols-1">
            <div class="field">
              <label>Company <span class="req">*</span></label>
              <select id="f-company">
                <option value="">‚Äî Select Company ‚Äî</option>
                <option value="JVT">JVT CORPORATION</option>
                <option value="LIT">LITRAD INC</option>
              </select>
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Employee Name <span class="req">*</span></label>
              <input type="text" id="f-empname" placeholder="e.g. EDDIESON ALDONZA">
            </div>
          </div>
          <div class="field-row cols-2">
            <div class="field">
              <label>Designation <span class="req">*</span></label>
              <input type="text" id="f-designation" placeholder="e.g. ASSEMBLER">
            </div>
            <div class="field">
              <label>Department <span class="req">*</span></label>
              <input type="text" id="f-department" placeholder="e.g. PRODUCTION">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Date of Joining</label>
              <input type="date" id="f-doj">
            </div>
          </div>
        </div>
      </div>

      <!-- Pay Period -->
      <div class="section-card">
        <div class="card-header"><div class="card-header-icon">üìÖ</div><h3>Pay Period</h3></div>
        <div class="card-body">
          <div class="field-row cols-2">
            <div class="field">
              <label>Pay Period From <span class="req">*</span></label>
              <input type="date" id="f-period-from">
            </div>
            <div class="field">
              <label>Pay Period To <span class="req">*</span></label>
              <input type="date" id="f-period-to">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Worked Pay Date</label>
              <input type="date" id="f-worked-date">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Prepared By</label>
              <input type="text" id="f-prepared-by" value="Cristian Enriquez" placeholder="HR Staff name">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Prepared By Title</label>
              <input type="text" id="f-prepared-title" value="HR Staff" placeholder="e.g. HR Staff">
            </div>
          </div>
        </div>
      </div>

      <!-- Earnings & Deductions -->
      <div class="section-card full">
        <div class="card-header"><div class="card-header-icon">üí∞</div><h3>Earnings & Deductions</h3></div>
        <div class="split-grid">
          <!-- EARNINGS -->
          <div class="split-col">
            <div class="split-header">
              <span>Earnings</span>
              <span style="font-size:11px;color:var(--gray)">Amount</span>
            </div>
            <div class="split-row">
              <label>Basic Pay</label>
              <input type="number" id="e-basic" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Allowance</label>
              <input type="number" id="e-allowance" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Overtime</label>
              <input type="number" id="e-overtime" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Holiday Pay</label>
              <input type="number" id="e-holiday" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Other Earnings</label>
              <input type="number" id="e-other" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="total-row">
              <span>Total Earnings</span>
              <span class="total-val" id="e-total">0.00</span>
            </div>
          </div>

          <!-- DEDUCTIONS -->
          <div class="split-col">
            <div class="split-header">
              <span>Deductions</span>
              <span style="font-size:11px;color:var(--gray)">Amount</span>
            </div>
            <div class="split-row">
              <label>SSS</label>
              <input type="number" id="d-sss" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>PhilHealth</label>
              <input type="number" id="d-philhealth" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Pag-IBIG</label>
              <input type="number" id="d-pagibig" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>SSS Loan</label>
              <input type="number" id="d-sss-loan" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Pag-IBIG Loan</label>
              <input type="number" id="d-pagibig-loan" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Absence</label>
              <input type="number" id="d-absence" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Cash Advance</label>
              <input type="number" id="d-cash-advance" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="split-row">
              <label>Other Deductions</label>
              <input type="number" id="d-other" placeholder="0.00" step="0.01" oninput="compute()">
            </div>
            <div class="total-row">
              <span>Total Deductions</span>
              <span class="total-val" id="d-total">0.00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Net Pay Strip -->
      <div class="section-card full">
        <div class="card-body" style="padding:0">
          <div class="net-strip">
            <div>
              <div class="nl">Net Pay</div>
              <div class="nv" id="cs-net">‚Ç± 0.00</div>
            </div>
            <div class="nw" id="cs-words" style="color:#8ba3c7;font-style:italic;font-size:12px;">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="section-card full">
        <div class="card-body">
          <div class="submit-row">
            <button class="btn-submit" onclick="submitPayslip()">
              <span style="font-size:20px">‚ú¶</span> GENERATE PAYSLIP
            </button>
            <button class="btn-clear" onclick="clearForm()">Clear</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚ïê‚ïê DATABASE ‚ïê‚ïê -->
  <div class="page" id="page-database">
    <div class="page-title">
      <h2>Payslip Records</h2>
      <p>All generated payslips. View, edit or delete any record.</p>
    </div>
    <div class="db-toolbar">
      <input class="db-search-box" type="text" id="db-search" placeholder="üîç  Search employee, period..." oninput="renderDatabase()">
      <div class="db-stats">
        <div class="db-stat"><strong id="stat-count">0</strong>Payslips</div>
        <div class="db-stat"><strong id="stat-gross">‚Ç±0</strong>Total Gross</div>
        <div class="db-stat"><strong id="stat-net">‚Ç±0</strong>Total Net</div>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Company</th>
            <th>Employee</th>
            <th>Designation</th>
            <th>Department</th>
            <th>Pay Period</th>
            <th>Total Earnings</th>
            <th>Total Deductions</th>
            <th>Net Pay</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="db-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- ‚ïê‚ïê EMPLOYEES ‚ïê‚ïê -->
  <div class="page" id="page-employees">
    <div class="page-title">
      <h2>Employee Directory</h2>
      <p>Save employee names and basic salaries for quick payslip creation.</p>
    </div>
    <div id="emp-toast" class="toast"></div>

    <div class="form-grid">
      <!-- Add new employee -->
      <div class="section-card">
        <div class="card-header"><div class="card-header-icon">‚ûï</div><h3>Add / Update Employee</h3></div>
        <div class="card-body">
          <div class="field-row cols-1">
            <div class="field">
              <label>Employee Name <span class="req">*</span></label>
              <input type="text" id="new-emp-name" placeholder="e.g. EDDIESON ALDONZA">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Basic Salary <span class="req">*</span></label>
              <input type="number" id="new-emp-salary" placeholder="0.00" step="0.01">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Company</label>
              <select id="new-emp-company">
                <option value="">‚Äî Select ‚Äî</option>
                <option value="JVT">JVT CORPORATION</option>
                <option value="LIT">LITRAD INC</option>
              </select>
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Designation</label>
              <input type="text" id="new-emp-designation" placeholder="e.g. ASSEMBLER">
            </div>
          </div>
          <div class="field-row cols-1">
            <div class="field">
              <label>Department</label>
              <input type="text" id="new-emp-department" placeholder="e.g. PRODUCTION">
            </div>
          </div>

          <div style="margin-top:10px;padding-top:10px;border-top:2px solid var(--navy);">
            <div style="font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--navy);margin-bottom:10px;">Default Deductions</div>
            <div class="field-row cols-2">
              <div class="field"><label>SSS</label><input type="number" id="new-emp-sss" placeholder="0.00" step="0.01"></div>
              <div class="field"><label>PhilHealth</label><input type="number" id="new-emp-philhealth" placeholder="0.00" step="0.01"></div>
            </div>
            <div class="field-row cols-2">
              <div class="field"><label>Pag-IBIG</label><input type="number" id="new-emp-pagibig" placeholder="0.00" step="0.01"></div>
              <div class="field"><label>SSS Loan</label><input type="number" id="new-emp-sss-loan" placeholder="0.00" step="0.01"></div>
            </div>
            <div class="field-row cols-2">
              <div class="field"><label>Pag-IBIG Loan</label><input type="number" id="new-emp-pagibig-loan" placeholder="0.00" step="0.01"></div>
              <div class="field"><label>Absence</label><input type="number" id="new-emp-absence" placeholder="0.00" step="0.01"></div>
            </div>
            <div class="field-row cols-2">
              <div class="field"><label>Cash Advance</label><input type="number" id="new-emp-cash-advance" placeholder="0.00" step="0.01"></div>
              <div class="field"><label>Other Deductions</label><input type="number" id="new-emp-other-ded" placeholder="0.00" step="0.01"></div>
            </div>
          </div>
          <div style="margin-top:16px;display:flex;gap:10px;">
            <button class="btn-submit" style="padding:12px 24px;font-size:14px;" onclick="saveEmployee()">üíæ Save Employee</button>
            <button class="btn-clear" style="padding:12px 18px;" onclick="clearEmpForm()">Clear</button>
          </div>
        </div>
      </div>

      <!-- Employee list -->
      <div class="section-card">
        <div class="card-header"><div class="card-header-icon">üë•</div><h3>Saved Employees (<span id="emp-count">0</span>)</h3></div>
        <div class="card-body" style="padding:0">
          <div id="emp-directory-list" style="max-height:480px;overflow-y:auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PRINT ‚ïê‚ïê -->
  <div class="page" id="page-print">
    <div class="print-selector no-print">
      <label>Select Payslip:</label>
      <select id="print-select" onchange="renderPrint()">
        <option value="">‚Äî Select a payslip to view ‚Äî</option>
      </select>
      <button class="btn-print" onclick="window.print()">üñ® &nbsp;Print</button>
    </div>
    <div id="print-area">
      <div class="no-payslip"><div class="nv-icon">üñ®</div><p>Select a payslip above to preview and print.</p></div>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê CONFIRM DELETE ‚ïê‚ïê -->
<div class="confirm-overlay" id="confirm-modal">
  <div class="confirm-box">
    <div class="confirm-icon">üóëÔ∏è</div>
    <h3 id="confirm-title">Delete Payslip?</h3>
    <p id="confirm-msg">This cannot be undone.</p>
    <div class="confirm-btns">
      <button class="btn-confirm-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="btn-confirm-del" onclick="confirmDelete()">Yes, Delete</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê EDIT MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>‚úèÔ∏è &nbsp;Edit Payslip</h3>
      <button class="modal-close" onclick="closeEdit()">‚úï</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="edit-index">
      <div class="form-grid" style="gap:14px">
        <div class="section-card">
          <div class="card-header"><div class="card-header-icon">üè¢</div><h3>Company & Employee</h3></div>
          <div class="card-body">
            <div class="field-row cols-1">
              <div class="field"><label>Company</label>
                <select id="edit-company">
                  <option value="JVT">JVT CORPORATION</option>
                  <option value="LIT">LITRAD INC</option>
                </select>
              </div>
            </div>
            <div class="field-row cols-1"><div class="field"><label>Employee Name</label><input type="text" id="edit-empname"></div></div>
            <div class="field-row cols-2">
              <div class="field"><label>Designation</label><input type="text" id="edit-designation"></div>
              <div class="field"><label>Department</label><input type="text" id="edit-department"></div>
            </div>
            <div class="field-row cols-1"><div class="field"><label>Date of Joining</label><input type="date" id="edit-doj"></div></div>
          </div>
        </div>
        <div class="section-card">
          <div class="card-header"><div class="card-header-icon">üìÖ</div><h3>Pay Period</h3></div>
          <div class="card-body">
            <div class="field-row cols-2">
              <div class="field"><label>Period From</label><input type="date" id="edit-period-from"></div>
              <div class="field"><label>Period To</label><input type="date" id="edit-period-to"></div>
            </div>
            <div class="field-row cols-1"><div class="field"><label>Worked Pay Date</label><input type="date" id="edit-worked-date"></div></div>
            <div class="field-row cols-1"><div class="field"><label>Prepared By</label><input type="text" id="edit-prepared-by"></div></div>
            <div class="field-row cols-1"><div class="field"><label>Prepared By Title</label><input type="text" id="edit-prepared-title"></div></div>
          </div>
        </div>
        <div class="section-card full">
          <div class="card-header"><div class="card-header-icon">üí∞</div><h3>Earnings & Deductions</h3></div>
          <div class="split-grid">
            <div class="split-col">
              <div class="split-header"><span>Earnings</span><span style="font-size:11px;color:var(--gray)">Amount</span></div>
              <div class="split-row"><label>Basic Pay</label><input type="number" id="edit-basic" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Allowance</label><input type="number" id="edit-allowance" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Overtime</label><input type="number" id="edit-overtime" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Holiday Pay</label><input type="number" id="edit-holiday" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Other Earnings</label><input type="number" id="edit-other-earn" step="0.01" oninput="computeEdit()"></div>
              <div class="total-row"><span>Total Earnings</span><span class="total-val" id="edit-e-total">0.00</span></div>
            </div>
            <div class="split-col">
              <div class="split-header"><span>Deductions</span><span style="font-size:11px;color:var(--gray)">Amount</span></div>
              <div class="split-row"><label>SSS</label><input type="number" id="edit-sss" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>PhilHealth</label><input type="number" id="edit-philhealth" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Pag-IBIG</label><input type="number" id="edit-pagibig" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>SSS Loan</label><input type="number" id="edit-sss-loan" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Pag-IBIG Loan</label><input type="number" id="edit-pagibig-loan" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Absence</label><input type="number" id="edit-absence" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Cash Advance</label><input type="number" id="edit-cash-advance" step="0.01" oninput="computeEdit()"></div>
              <div class="split-row"><label>Other Deductions</label><input type="number" id="edit-other-ded" step="0.01" oninput="computeEdit()"></div>
              <div class="total-row"><span>Total Deductions</span><span class="total-val" id="edit-d-total">0.00</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeEdit()">Cancel</button>
      <button class="btn-save" onclick="saveEdit()">üíæ &nbsp;Save Changes</button>
    </div>
  </div>
</div>

<script type="module">
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import {
  getFirestore, collection, doc,
  onSnapshot, addDoc, setDoc, deleteDoc, query, orderBy
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

// ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
// ‚îÇ  YOUR FIREBASE CONFIG ‚Äî paste your own config here      ‚îÇ
// ‚îÇ  Get it from: console.firebase.google.com               ‚îÇ
// ‚îÇ  Project Settings ‚Üí Your Apps ‚Üí Firebase SDK snippet    ‚îÇ
// ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
const firebaseConfig = {
  apiKey:            "AIzaSyAQj2BojvmW8S1B_yfhztzdyq3EqTn2rkM",
  authDomain:        "jvt-payslip-21f30.firebaseapp.com",
  projectId:         "jvt-payslip-21f30",
  storageBucket:     "jvt-payslip-21f30.firebasestorage.app",
  messagingSenderId: "3261180016",
  appId:             "1:3261180016:web:3bb6022f6e858178112cb5"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

const PAYSLIPS_COL  = 'payslips';
const EMPLOYEES_COL = 'employees';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CO = {
  JVT: { name:'JVT CORPORATION', address:'JVT CORPORATION, 23 KATIPUNAN AVE.,\nCALIFORNIA VILLAGE, SAN BARTOLEME, QUEZON CITY' },
  LIT: { name:'LITRAD INC',      address:'LITRAD INC, 23 KATIPUNAN AVE.,\nCALIFORNIA VILLAGE, SAN BARTOLEME, QUEZON CITY' },
};

let records   = [];
let employees = [];
let pendingDel = null;
let pendingDelType = 'payslip';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REAL-TIME LISTENERS ‚Äî auto-update all users instantly
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initListeners() {
  // Payslips
  onSnapshot(query(collection(db, PAYSLIPS_COL), orderBy('createdAt', 'asc')), snap => {
    records = snap.docs.map(d => ({ ...d.data(), _docId: d.id }));
    renderDatabase();
    renderPrintSelect();
    refreshEmpDropdown();
  });
  // Employees
  onSnapshot(query(collection(db, EMPLOYEES_COL), orderBy('name', 'asc')), snap => {
    employees = snap.docs.map(d => ({ ...d.data(), _docId: d.id }));
    renderEmployeeDirectory();
    refreshEmpDropdown();
  });
}

async function savePayslip(rec) {
  if (rec._docId) {
    const { _docId, ...data } = rec;
    await setDoc(doc(db, PAYSLIPS_COL, _docId), data);
  } else {
    await addDoc(collection(db, PAYSLIPS_COL), { ...rec, createdAt: Date.now() });
  }
}
async function deletePayslip(docId) { await deleteDoc(doc(db, PAYSLIPS_COL, docId)); }
async function saveEmp(emp) {
  if (emp._docId) {
    const { _docId, ...data } = emp;
    await setDoc(doc(db, EMPLOYEES_COL, _docId), data);
  } else {
    await addDoc(collection(db, EMPLOYEES_COL), emp);
  }
}
async function deleteEmp(docId) { await deleteDoc(doc(db, EMPLOYEES_COL, docId)); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(name, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name==='database')  renderDatabase();
  if (name==='print')     renderPrintSelect();
  if (name==='employees') renderEmployeeDirectory();
}
function goTo(name) {
  const tabs=['entry','database','employees','print'];
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach((t,i)=>{t.classList.remove('active');if(tabs[i]===name)t.classList.add('active');});
  document.getElementById('page-'+name).classList.add('active');
  if(name==='print')     renderPrintSelect();
  if(name==='employees') renderEmployeeDirectory();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmt(n){ return Number(n||0).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function fmtDate(d){
  if(!d) return '';
  const dt = new Date(d+'T00:00:00');
  return dt.toLocaleDateString('en-PH',{month:'short',day:'numeric',year:'numeric'});
}
function fmtPeriod(from,to){
  if(!from||!to) return '';
  const f=new Date(from+'T00:00:00'), t=new Date(to+'T00:00:00');
  const mo=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
  return `${mo[f.getMonth()]} ${f.getDate()} - ${mo[t.getMonth()]} ${t.getDate()}`;
}
function numToWords(n){
  if(!n||isNaN(n)) return '';
  const ones=['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine',
    'Ten','Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
  const tens=['','','Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];
  function conv(x){
    if(x===0) return '';
    if(x<20) return ones[x]+' ';
    if(x<100) return tens[Math.floor(x/10)]+(x%10?' '+ones[x%10]:'')+' ';
    if(x<1000) return ones[Math.floor(x/100)]+' Hundred '+conv(x%100);
    if(x<1000000) return conv(Math.floor(x/1000))+'Thousand '+conv(x%1000);
    return conv(Math.floor(x/1000000))+'Million '+conv(x%1000000);
  }
  const parts=Number(n).toFixed(2).split('.');
  const p=parseInt(parts[0]),c=parseInt(parts[1]);
  return conv(p).trim()+' Pesos'+(c>0?' and '+c+'/100':' and 00/100')+' Only';
}
function showToast(msg,err=false,toastId='toast'){
  const t=document.getElementById(toastId);
  t.innerHTML=msg; t.className='toast show'+(err?' error':'');
  clearTimeout(t._t); t._t=setTimeout(()=>t.classList.remove('show'),4500);
}
function g(id){ return parseFloat(document.getElementById(id).value)||0; }
function gv(id){ return document.getElementById(id).value.trim(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE DIRECTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveEmployee(){
  const name = gv('new-emp-name').toUpperCase();
  const salary = parseFloat(document.getElementById('new-emp-salary').value)||0;
  if(!name){ showToast('‚ö†Ô∏è Employee name is required.', true, 'emp-toast'); return; }
  if(!salary){ showToast('‚ö†Ô∏è Basic salary is required.', true, 'emp-toast'); return; }

  const existing = employees.find(e=>e.name===name);
  const emp = {
    ...(existing || {}),
    name,
    basicSalary: salary,
    company: gv('new-emp-company'),
    designation: gv('new-emp-designation').toUpperCase(),
    department: gv('new-emp-department').toUpperCase(),
    sss:         parseFloat(document.getElementById('new-emp-sss').value)||0,
    philhealth:  parseFloat(document.getElementById('new-emp-philhealth').value)||0,
    pagibig:     parseFloat(document.getElementById('new-emp-pagibig').value)||0,
    sssLoan:     parseFloat(document.getElementById('new-emp-sss-loan').value)||0,
    pagibigLoan: parseFloat(document.getElementById('new-emp-pagibig-loan').value)||0,
    absence:     parseFloat(document.getElementById('new-emp-absence').value)||0,
    cashAdvance: parseFloat(document.getElementById('new-emp-cash-advance').value)||0,
    otherDed:    parseFloat(document.getElementById('new-emp-other-ded').value)||0,
  };
  try {
    setLoading(true);
    await saveEmp(emp);
    showToast(existing ? `‚úî <strong>${name}</strong> updated.` : `‚úî <strong>${name}</strong> saved.`, false, 'emp-toast');
    clearEmpForm();
  } catch(e) {
    showToast('‚ùå Error saving employee.', true, 'emp-toast');
    console.error(e);
  } finally { setLoading(false); }
}

function clearEmpForm(){
  ['new-emp-name','new-emp-salary','new-emp-designation','new-emp-department',
   'new-emp-sss','new-emp-philhealth','new-emp-pagibig','new-emp-sss-loan',
   'new-emp-pagibig-loan','new-emp-absence','new-emp-cash-advance','new-emp-other-ded'
  ].forEach(id=>{ document.getElementById(id).value=''; });
  document.getElementById('new-emp-company').selectedIndex=0;
}

function renderEmployeeDirectory(){
  const list = document.getElementById('emp-directory-list');
  document.getElementById('emp-count').textContent = employees.length;
  if(!employees.length){
    list.innerHTML=`<div class="no-emp">No employees saved yet.<br>Add one using the form on the left.</div>`;
    return;
  }
  list.innerHTML = employees.map((e,i)=>`
    <div class="emp-list-item">
      <div>
        <div class="emp-list-name">${e.name}</div>
        <div style="font-size:11px;color:var(--gray);margin-top:2px;">
          ${e.company ? `<span class="badge ${e.company==='JVT'?'jvt':'lit'}" style="margin-right:6px;">${e.company}</span>` : ''}
          ${e.designation||''} ${e.department?'¬∑ '+e.department:''}
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;">
        <div class="emp-list-salary">‚Ç± ${fmt(e.basicSalary)}</div>
        <button class="btn-emp-del-row" onclick="loadEmpToForm(${i})" title="Load to form">‚úèÔ∏è</button>
        <button class="btn-emp-del-row" onclick="confirmDeleteEmployee(${i})" title="Delete">üóë</button>
      </div>
    </div>
  `).join('');
}

function loadEmpToForm(i){
  const e = employees[i];
  document.getElementById('new-emp-name').value = e.name;
  document.getElementById('new-emp-salary').value = e.basicSalary;
  document.getElementById('new-emp-company').value = e.company||'';
  document.getElementById('new-emp-designation').value = e.designation||'';
  document.getElementById('new-emp-department').value = e.department||'';
  document.getElementById('new-emp-sss').value = e.sss||'';
  document.getElementById('new-emp-philhealth').value = e.philhealth||'';
  document.getElementById('new-emp-pagibig').value = e.pagibig||'';
  document.getElementById('new-emp-sss-loan').value = e.sssLoan||'';
  document.getElementById('new-emp-pagibig-loan').value = e.pagibigLoan||'';
  document.getElementById('new-emp-absence').value = e.absence||'';
  document.getElementById('new-emp-cash-advance').value = e.cashAdvance||'';
  document.getElementById('new-emp-other-ded').value = e.otherDed||'';
}

function confirmDeleteEmployee(i){
  pendingDelType = 'employee';
  pendingDel = i;
  document.getElementById('confirm-title').textContent = 'Delete Employee?';
  document.getElementById('confirm-msg').textContent = `Remove ${employees[i].name} from the directory? This cannot be undone.`;
  document.getElementById('confirm-modal').classList.add('open');
}

function refreshEmpDropdown(){
  const sel = document.getElementById('emp-quick-select');
  const cur = sel.value;
  sel.innerHTML = '<option value="">‚Äî Quick fill from saved ‚Äî</option>' +
    employees.map(e=>`<option value="${e.id}">${e.name} ‚Äî ‚Ç±${fmt(e.basicSalary)}</option>`).join('');
  if(cur) sel.value = cur;
}

function quickFillEmployee(){
  const id = parseInt(document.getElementById('emp-quick-select').value);
  if(!id) return;
  const e = employees.find(x=>x.id===id);
  if(!e) return;
  document.getElementById('f-empname').value = e.name;
  document.getElementById('e-basic').value = e.basicSalary;
  if(e.company)      document.getElementById('f-company').value     = e.company;
  if(e.designation)  document.getElementById('f-designation').value = e.designation;
  if(e.department)   document.getElementById('f-department').value  = e.department;
  if(e.sss)          document.getElementById('d-sss').value         = e.sss;
  if(e.philhealth)   document.getElementById('d-philhealth').value  = e.philhealth;
  if(e.pagibig)      document.getElementById('d-pagibig').value     = e.pagibig;
  if(e.sssLoan)      document.getElementById('d-sss-loan').value    = e.sssLoan;
  if(e.pagibigLoan)  document.getElementById('d-pagibig-loan').value= e.pagibigLoan;
  if(e.absence)      document.getElementById('d-absence').value     = e.absence;
  if(e.cashAdvance)  document.getElementById('d-cash-advance').value= e.cashAdvance;
  if(e.otherDed)     document.getElementById('d-other').value       = e.otherDed;
  compute();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPUTE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function compute(){
  const earn = g('e-basic')+g('e-allowance')+g('e-overtime')+g('e-holiday')+g('e-other');
  const ded  = g('d-sss')+g('d-philhealth')+g('d-pagibig')+g('d-sss-loan')+g('d-pagibig-loan')+g('d-absence')+g('d-cash-advance')+g('d-other');
  const net  = earn - ded;
  document.getElementById('e-total').textContent = fmt(earn);
  document.getElementById('d-total').textContent = fmt(ded);
  document.getElementById('cs-net').textContent  = '‚Ç± '+fmt(net);
  document.getElementById('cs-words').textContent = numToWords(net);
}
function computeEdit(){
  const earn = g('edit-basic')+g('edit-allowance')+g('edit-overtime')+g('edit-holiday')+g('edit-other-earn');
  const ded  = g('edit-sss')+g('edit-philhealth')+g('edit-pagibig')+g('edit-sss-loan')+g('edit-pagibig-loan')+g('edit-absence')+g('edit-cash-advance')+g('edit-other-ded');
  document.getElementById('edit-e-total').textContent = fmt(earn);
  document.getElementById('edit-d-total').textContent = fmt(ded);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUBMIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function submitPayslip(){
  const errs=[];
  if(!gv('f-company')) errs.push('Company');
  if(!gv('f-empname')) errs.push('Employee Name');
  if(!gv('f-designation')) errs.push('Designation');
  if(!gv('f-department')) errs.push('Department');
  if(!gv('f-period-from')) errs.push('Pay Period From');
  if(!gv('f-period-to')) errs.push('Pay Period To');
  if(errs.length){ showToast('‚ö†Ô∏è Required: '+errs.join(', '),true); return; }

  const earn = g('e-basic')+g('e-allowance')+g('e-overtime')+g('e-holiday')+g('e-other');
  const ded  = g('d-sss')+g('d-philhealth')+g('d-pagibig')+g('d-sss-loan')+g('d-pagibig-loan')+g('d-absence')+g('d-cash-advance')+g('d-other');

  const rec = {
    id: Date.now(),
    company: gv('f-company'),
    empName: gv('f-empname').toUpperCase(),
    designation: gv('f-designation').toUpperCase(),
    department: gv('f-department').toUpperCase(),
    doj: gv('f-doj'),
    periodFrom: gv('f-period-from'),
    periodTo: gv('f-period-to'),
    workedDate: gv('f-worked-date'),
    preparedBy: gv('f-prepared-by') || 'Cristian Enriquez',
    preparedTitle: gv('f-prepared-title') || 'HR Staff',
    basicPay: g('e-basic'), allowance: g('e-allowance'),
    overtime: g('e-overtime'), holidayPay: g('e-holiday'), otherEarn: g('e-other'),
    totalEarn: earn,
    sss: g('d-sss'), philhealth: g('d-philhealth'), pagibig: g('d-pagibig'),
    sssLoan: g('d-sss-loan'), pagibigLoan: g('d-pagibig-loan'),
    absence: g('d-absence'), cashAdvance: g('d-cash-advance'), otherDed: g('d-other'),
    totalDed: ded,
    netPay: earn - ded,
  };

  try {
    setLoading(true);
    await savePayslip(rec);
    showToast(`‚úî Payslip for <strong>${rec.empName}</strong> generated!`);
    clearForm();
  } catch(e) {
    showToast('‚ùå Error saving payslip. Check your Firebase config.', true);
    console.error(e);
  } finally { setLoading(false); }
}

function clearForm(){
  ['f-company','f-empname','f-designation','f-department',
   'f-period-from','f-period-to','f-worked-date',
   'e-basic','e-allowance','e-overtime','e-holiday','e-other',
   'd-sss','d-philhealth','d-pagibig','d-sss-loan','d-pagibig-loan','d-absence','d-cash-advance','d-other'
  ].forEach(id=>{
    const el=document.getElementById(id);
    if(el.tagName==='SELECT') el.selectedIndex=0; else el.value='';
  });
  document.getElementById('f-doj').value='';
  document.getElementById('f-prepared-by').value='Cristian Enriquez';
  document.getElementById('f-prepared-title').value='HR Staff';
  document.getElementById('emp-quick-select').selectedIndex=0;
  document.getElementById('e-total').textContent='0.00';
  document.getElementById('d-total').textContent='0.00';
  document.getElementById('cs-net').textContent='‚Ç± 0.00';
  document.getElementById('cs-words').textContent='‚Äî';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDatabase(){
  const q=(document.getElementById('db-search').value||'').toLowerCase();
  const filtered=records.map((r,i)=>({...r,_i:i})).filter(r=>
    r.empName.toLowerCase().includes(q)||
    (r.designation||'').toLowerCase().includes(q)||
    (r.department||'').toLowerCase().includes(q)||
    (r.periodFrom||'').includes(q)
  );
  const tbody=document.getElementById('db-tbody');
  if(!filtered.length){
    tbody.innerHTML=`<tr><td colspan="10"><div class="empty-state"><div class="es-icon">üìÑ</div><p>${records.length?'No results.':'No payslips yet.'}</p></div></td></tr>`;
  } else {
    tbody.innerHTML=[...filtered].reverse().map(r=>`<tr>
      <td class="mono" style="font-size:11px">#${r.id}</td>
      <td><span class="badge ${r.company==='JVT'?'jvt':'lit'}">${r.company}</span></td>
      <td><strong>${r.empName}</strong></td>
      <td>${r.designation}</td>
      <td>${r.department}</td>
      <td class="mono">${fmtPeriod(r.periodFrom,r.periodTo)}</td>
      <td class="amount">‚Ç± ${fmt(r.totalEarn)}</td>
      <td class="amount" style="color:var(--red)">‚Ç± ${fmt(r.totalDed)}</td>
      <td class="net">‚Ç± ${fmt(r.netPay)}</td>
      <td><div class="action-btns">
        <button class="btn-icon view" onclick="viewPayslip(${r._i})">üëÅ View</button>
        <button class="btn-icon edit" onclick="openEdit(${r._i})">‚úèÔ∏è Edit</button>
        <button class="btn-icon del" onclick="openConfirm(${r._i})">üóë Delete</button>
      </div></td>
    </tr>`).join('');
  }
  document.getElementById('stat-count').textContent=records.length;
  document.getElementById('stat-gross').textContent='‚Ç±'+fmt(records.reduce((s,r)=>s+r.totalEarn,0));
  document.getElementById('stat-net').textContent='‚Ç±'+fmt(records.reduce((s,r)=>s+r.netPay,0));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EDIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openEdit(idx){
  const r=records[idx];
  document.getElementById('edit-index').value=idx;
  document.getElementById('edit-company').value=r.company;
  document.getElementById('edit-empname').value=r.empName;
  document.getElementById('edit-designation').value=r.designation;
  document.getElementById('edit-department').value=r.department;
  document.getElementById('edit-doj').value=r.doj||'';
  document.getElementById('edit-period-from').value=r.periodFrom;
  document.getElementById('edit-period-to').value=r.periodTo;
  document.getElementById('edit-worked-date').value=r.workedDate||'';
  document.getElementById('edit-prepared-by').value=r.preparedBy||'';
  document.getElementById('edit-prepared-title').value=r.preparedTitle||'';
  document.getElementById('edit-basic').value=r.basicPay||'';
  document.getElementById('edit-allowance').value=r.allowance||'';
  document.getElementById('edit-overtime').value=r.overtime||'';
  document.getElementById('edit-holiday').value=r.holidayPay||'';
  document.getElementById('edit-other-earn').value=r.otherEarn||'';
  document.getElementById('edit-sss').value=r.sss||'';
  document.getElementById('edit-philhealth').value=r.philhealth||'';
  document.getElementById('edit-pagibig').value=r.pagibig||'';
  document.getElementById('edit-sss-loan').value=r.sssLoan||'';
  document.getElementById('edit-pagibig-loan').value=r.pagibigLoan||'';
  document.getElementById('edit-absence').value=r.absence||'';
  document.getElementById('edit-cash-advance').value=r.cashAdvance||'';
  document.getElementById('edit-other-ded').value=r.otherDed||'';
  computeEdit();
  document.getElementById('edit-modal').classList.add('open');
}
async function saveEdit(){
  const idx=parseInt(document.getElementById('edit-index').value);
  const earn=g('edit-basic')+g('edit-allowance')+g('edit-overtime')+g('edit-holiday')+g('edit-other-earn');
  const ded=g('edit-sss')+g('edit-philhealth')+g('edit-pagibig')+g('edit-sss-loan')+g('edit-pagibig-loan')+g('edit-absence')+g('edit-cash-advance')+g('edit-other-ded');
  const updated={
    ...records[idx],
    company:document.getElementById('edit-company').value,
    empName:document.getElementById('edit-empname').value.toUpperCase(),
    designation:document.getElementById('edit-designation').value.toUpperCase(),
    department:document.getElementById('edit-department').value.toUpperCase(),
    doj:document.getElementById('edit-doj').value,
    periodFrom:document.getElementById('edit-period-from').value,
    periodTo:document.getElementById('edit-period-to').value,
    workedDate:document.getElementById('edit-worked-date').value,
    preparedBy:document.getElementById('edit-prepared-by').value,
    preparedTitle:document.getElementById('edit-prepared-title').value,
    basicPay:g('edit-basic'),allowance:g('edit-allowance'),overtime:g('edit-overtime'),
    holidayPay:g('edit-holiday'),otherEarn:g('edit-other-earn'),totalEarn:earn,
    sss:g('edit-sss'),philhealth:g('edit-philhealth'),pagibig:g('edit-pagibig'),
    sssLoan:g('edit-sss-loan'),pagibigLoan:g('edit-pagibig-loan'),
    absence:g('edit-absence'),cashAdvance:g('edit-cash-advance'),otherDed:g('edit-other-ded'),
    totalDed:ded,netPay:earn-ded,
  };
  try {
    setLoading(true);
    await savePayslip(updated);
    closeEdit();
    showToast(`‚úî Payslip for <strong>${updated.empName}</strong> updated!`);
  } catch(e) {
    showToast('‚ùå Error updating payslip.', true);
    console.error(e);
  } finally { setLoading(false); }
}
function closeEdit(){ document.getElementById('edit-modal').classList.remove('open'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DELETE (shared for payslips & employees)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openConfirm(idx){
  pendingDelType = 'payslip';
  pendingDel=idx;
  const r=records[idx];
  document.getElementById('confirm-title').textContent = 'Delete Payslip?';
  document.getElementById('confirm-msg').textContent=`Delete payslip for ${r.empName} ‚Äî Period: ${fmtPeriod(r.periodFrom,r.periodTo)}? This cannot be undone.`;
  document.getElementById('confirm-modal').classList.add('open');
}
async function confirmDelete(){
  try {
    setLoading(true);
    if(pendingDelType==='employee'){
      const emp = employees[pendingDel];
      await deleteEmp(emp._docId);
      closeConfirm();
      showToast(`üóë <strong>${emp.name}</strong> removed from directory.`, false, 'emp-toast');
    } else {
      const rec = records[pendingDel];
      await deletePayslip(rec._docId);
      closeConfirm();
      showToast(`üóë Payslip for <strong>${rec.empName}</strong> deleted.`);
    }
  } catch(e) {
    showToast('‚ùå Error deleting record.', true);
    console.error(e);
  } finally { setLoading(false); }
}
function closeConfirm(){ pendingDel=null; document.getElementById('confirm-modal').classList.remove('open'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRINT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderPrintSelect(){
  const sel=document.getElementById('print-select');
  const cur=sel.value;
  sel.innerHTML='<option value="">‚Äî Select a payslip to view ‚Äî</option>'+
    [...records].reverse().map(r=>
      `<option value="${r.id}">${r.empName} ¬∑ ${fmtPeriod(r.periodFrom,r.periodTo)} ¬∑ ‚Ç±${fmt(r.netPay)}</option>`
    ).join('');
  if(cur) sel.value=cur;
}

function renderPrint(){
  const id=parseInt(document.getElementById('print-select').value);
  const area=document.getElementById('print-area');
  if(!id){ area.innerHTML=`<div class="no-payslip"><div class="nv-icon">üñ®</div><p>Select a payslip above to preview and print.</p></div>`; return; }
  const r=records.find(x=>x.id===id);
  if(!r) return;
  const co=CO[r.company];
  const words=numToWords(r.netPay);
  const isJVT=r.company==='JVT';

  function earnRow(label,val){ return val>0?`<div class="ps-item"><span class="ps-item-label">${label}</span><span class="ps-item-val">${fmt(val)}</span></div>`:`<div class="ps-item"><span class="ps-item-label">${label}</span><span class="ps-item-val"></span></div>`; }
  function dedRow(label,val){ return `<div class="ps-item"><span class="ps-item-label">${label}</span><span class="ps-item-val">${val>0?fmt(val):''}</span></div>`; }

  area.innerHTML=`
  <div class="payslip-paper">

    <!-- COMPANY NAME (no logo) -->
    <div class="ps-company-area">
      <div class="${isJVT?'ps-company-name':'ps-litrad-name'}">${co.name}</div>
    </div>

    <!-- TITLE -->
    <div class="ps-title"><h2>PAYSLIP</h2></div>
    <div class="ps-address">${co.address.replace('\n','<br>')}</div>

    <!-- DESCRIPTION HEADER -->
    <div class="ps-section-bar">DESCRIPTION</div>

    <!-- INFO GRID -->
    <div class="ps-info-grid">
      <div class="ps-info-col">
        <div class="ps-info-row">
          <span class="ps-info-label">Date of Joining</span>
          <span class="ps-info-value">${fmtDate(r.doj)}</span>
        </div>
        <div class="ps-info-row">
          <span class="ps-info-label">Pay Period</span>
          <span class="ps-info-value">${fmtPeriod(r.periodFrom,r.periodTo)}</span>
        </div>
        <div class="ps-info-row">
          <span class="ps-info-label">Worked Pay</span>
          <span class="ps-info-value">${fmtDate(r.workedDate)}</span>
        </div>
      </div>
      <div class="ps-info-col">
        <div class="ps-info-row">
          <span class="ps-info-label">Employee Name</span>
          <span class="ps-info-value">${r.empName}</span>
        </div>
        <div class="ps-info-row">
          <span class="ps-info-label">Designation</span>
          <span class="ps-info-value">${r.designation}</span>
        </div>
        <div class="ps-info-row">
          <span class="ps-info-label">Department</span>
          <span class="ps-info-value">${r.department}</span>
        </div>
      </div>
    </div>

    <!-- EARNINGS / DEDUCTIONS TABLE -->
    <div class="ps-table">
      <div class="ps-col">
        <div class="ps-col-header"><span>Earnings</span><span>Amount</span></div>
        ${earnRow('Basic Pay', r.basicPay)}
        ${earnRow('Allowance', r.allowance)}
        ${earnRow('Overtime', r.overtime)}
        ${earnRow('Holiday Pay', r.holidayPay)}
        ${r.otherEarn>0?earnRow('Other Earnings',r.otherEarn):''}
        <div class="ps-total-row">
          <span class="ps-total-label">Total Earnings</span>
          <span class="ps-total-val">${fmt(r.totalEarn)}</span>
        </div>
      </div>
      <div class="ps-col">
        <div class="ps-col-header"><span>Deductions</span><span>Amount</span></div>
        ${dedRow('SSS', r.sss)}
        ${dedRow('Philhealth', r.philhealth)}
        ${dedRow('Pag-IBIG', r.pagibig)}
        ${dedRow('SSS Loan', r.sssLoan)}
        ${dedRow('Pag-IBIG Loan', r.pagibigLoan)}
        ${dedRow('Absence', r.absence)}
        ${dedRow('Cash Advance', r.cashAdvance)}
        ${r.otherDed>0?dedRow('Other Deductions',r.otherDed):''}
        <div class="ps-total-row">
          <span class="ps-total-label">Total Deductions</span>
          <span class="ps-total-val">${fmt(r.totalDed)}</span>
        </div>
      </div>
    </div>

    <!-- NET PAY -->
    <div class="ps-net-bar">
      <span>NET PAY: ${fmt(r.netPay)}</span>
    </div>

    <!-- AMOUNT IN WORDS -->
    <div class="ps-words-row">
      <span class="ps-words-label">Amount in word</span>
      <span class="ps-words-value">${words}</span>
    </div>

    <!-- SIGNATURES -->
    <div class="ps-sigs">
      <div class="ps-sig-block">
        <div class="ps-prepared-label">Prepared by</div>
        <div class="ps-sig-line"></div>
        <div class="ps-sig-name">${r.preparedBy}</div>
        <div class="ps-sig-role">${r.preparedTitle}</div>
      </div>
      <div class="ps-sig-block">
        <div class="ps-prepared-label">&nbsp;</div>
        <div class="ps-sig-line"></div>
        <div class="ps-sig-role">Employee Signature</div>
      </div>
    </div>

  </div>`;
}

function viewPayslip(idx){
  goTo('print');
  setTimeout(()=>{
    document.getElementById('print-select').value=records[idx].id;
    renderPrint();
  },50);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOADING STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setLoading(on){
  document.querySelectorAll('.btn-submit,.btn-save,.btn-save-emp').forEach(b=>{
    b.disabled = on;
    b.style.opacity = on ? '0.6' : '1';
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = () => {
  compute();
  // Close modals on overlay click
  document.getElementById('edit-modal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeEdit(); });
  document.getElementById('confirm-modal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeConfirm(); });
  initListeners(); // starts real-time Firebase sync
};

// Expose all functions to global scope (required for ES module + inline onclick)
Object.assign(window, {
  showPage, goTo,
  compute, computeEdit,
  submitPayslip, clearForm,
  saveEmployee, clearEmpForm, loadEmpToForm, confirmDeleteEmployee, quickFillEmployee,
  renderDatabase, renderPrint, renderPrintSelect,
  openEdit, saveEdit, closeEdit,
  openConfirm, confirmDelete, closeConfirm,
  viewPayslip,
});
</script>
</body>
</html>
